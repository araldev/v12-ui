import{j as L}from"./jsx-runtime-mi3Lf1GD.js";import{r as y}from"./iframe-Co4mAa2f.js";import{c as E}from"./utils-BKj_NWD_.js";import{i as b}from"./brand-araldev-miniatura-UnVj_ezp.js";class M{canvas;ctx;particles=[];mouse=null;animationId=null;dpr;config;imageElement=null;constructor(e,o){this.canvas=e;const a=e.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("No se pudo obtener el contexto 2D del canvas");this.ctx=a,this.dpr=window.devicePixelRatio||1,this.config=o,this.setupCanvas(),this.initializeEffect()}async initializeEffect(){try{this.config.imageUrl?(console.log("MagicLogo: Cargando imagen desde URL:",this.config.imageUrl),await this.loadImage(this.config.imageUrl)):this.config.svgContent?(console.log("MagicLogo: Cargando SVG como imagen"),await this.loadSVGAsImage(this.config.svgContent)):this.config.imageElement&&(console.log("MagicLogo: Cargando elemento de imagen existente"),await this.loadImageElement(this.config.imageElement)),console.log("MagicLogo: Imagen cargada exitosamente, generando partículas..."),this.generateParticles(),this.setupEventListeners(),this.animate=this.animate.bind(this),this.animate()}catch(e){console.error("MagicLogo: Error al inicializar el efecto:",e)}}async loadImage(e){return await new Promise((o,a)=>{const t=new Image,n=()=>{this.imageElement=t,t.removeEventListener("load",n),t.removeEventListener("error",i),o()},i=r=>{t.removeEventListener("load",n),t.removeEventListener("error",i),a(new Error(`Error al cargar la imagen desde URL: ${e} - ${r.type}`))};t.addEventListener("load",n),t.addEventListener("error",i),t.crossOrigin="anonymous",t.src=e,setTimeout(()=>{t.removeEventListener("load",n),t.removeEventListener("error",i),a(new Error(`Timeout: La imagen desde URL ${e} tardó demasiado en cargar`))},1e4)})}async loadImageElement(e){return await new Promise((o,a)=>{if(e.complete&&e.naturalWidth>0)this.imageElement=e,o();else{const t=()=>{this.imageElement=e,e.removeEventListener("load",t),e.removeEventListener("error",n),o()},n=i=>{e.removeEventListener("load",t),e.removeEventListener("error",n),a(new Error(`Error al cargar la imagen: ${i.type}`))};e.addEventListener("load",t),e.addEventListener("error",n),setTimeout(()=>{e.removeEventListener("load",t),e.removeEventListener("error",n),a(new Error("Timeout: La imagen tardó demasiado en cargar"))},1e4)}})}async loadSVGAsImage(e){return await new Promise((o,a)=>{const t=new Blob([e],{type:"image/svg+xml"}),n=URL.createObjectURL(t),i=new Image,r=()=>{this.imageElement=i,URL.revokeObjectURL(n),i.removeEventListener("load",r),i.removeEventListener("error",s),o()},s=d=>{URL.revokeObjectURL(n),i.removeEventListener("load",r),i.removeEventListener("error",s),a(new Error(`Error al cargar SVG como imagen: ${d.type}`))};i.addEventListener("load",r),i.addEventListener("error",s),i.crossOrigin="anonymous",i.src=n,setTimeout(()=>{URL.revokeObjectURL(n),i.removeEventListener("load",r),i.removeEventListener("error",s),a(new Error("Timeout: El SVG tardó demasiado en cargar"))},1e4)})}setupCanvas(){const e=this.canvas.getBoundingClientRect();this.canvas.width=e.width*this.dpr,this.canvas.height=e.height*this.dpr,this.canvas.style.width=`${e.width}px`,this.canvas.style.height=`${e.height}px`,this.ctx.scale(this.dpr,this.dpr),this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality&&(this.ctx.imageSmoothingQuality="high")}createImageMask(){return this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.imageElement&&this.drawImageToCanvas(this.imageElement),this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height)}drawImageToCanvas(e){const o=this.canvas.width/this.dpr,a=this.canvas.height/this.dpr,n=Math.min(o/e.naturalWidth,a/e.naturalHeight)*.8,i=e.naturalWidth*n,r=e.naturalHeight*n,s=(o-i)/2,d=(a-r)/2;this.ctx.drawImage(e,s,d,i,r)}extractPositions(e){const o=[],{data:a,width:t,height:n}=e,r=Math.max(1,4);let s=0;for(let c=0;c<a.length;c+=4){const[l,m,h,u]=a.slice(c,c+4);u>50&&(l<220||m<220||h<220)&&s++}const d=Math.max(1,Math.floor(Math.sqrt(s/(this.config.particles||6e3)))),g=Math.min(r,d);for(let c=0;c<n;c+=g)for(let l=0;l<t;l+=g){const m=(c*t+l)*4,[h,u,f,w]=a.slice(m,m+4);w>50&&(h<220||u<220||f<220)&&o.push({x:l/this.dpr,y:c/this.dpr,color:`rgb(${h},${u},${f})`})}return o}generateParticles(){if(!this.imageElement){console.warn("No hay imagen cargada para generar partículas");return}const e=this.createImageMask(),o=this.extractPositions(e);if(o.length===0){console.warn("No se encontraron píxeles visibles en la imagen");return}const a=Math.max(this.canvas.width,this.canvas.height)*2;this.particles=o.map((t,n)=>({tx:t.x,ty:t.y,x:t.x+(Math.random()-.5)*a,y:t.y+(Math.random()-.5)*a,vx:0,vy:0,color:t.color,phase:Math.random()*Math.PI*2,age:0,order:n}))}updateParticle(e){const o=e.tx-e.x,a=e.ty-e.y;if(this.mouse){const i=this.mouse.x-e.x,r=this.mouse.y-e.y,s=Math.hypot(i,r),g=e.order*.08,l=(s-g)*.1;s>0&&(e.vx+=i/s*l,e.vy+=r/s*l)}const t=.04,n=.73;e.vx+=o*t,e.vy+=a*t,e.vx*=n,e.vy*=n,e.x+=e.vx,e.y+=e.vy}drawParticles(){const e=this.canvas.width/this.dpr,o=this.canvas.height/this.dpr;this.ctx.clearRect(0,0,e,o);for(const a of this.particles){this.updateParticle(a),a.age+=1;const t=(Math.sin(a.phase+a.age*.15)+1)/2;this.ctx.fillStyle=this.config.color||a.color||"#fff",this.config.glow&&(this.ctx.globalAlpha=t),this.ctx.beginPath(),this.ctx.arc(a.x,a.y,this.config.dotSize,0,Math.PI*2),this.ctx.fill()}this.ctx.globalAlpha=1}handleMouseMove=e=>{const o=this.canvas.getBoundingClientRect();this.mouse={x:(e.clientX-o.left)*(this.canvas.width/this.dpr/o.width),y:(e.clientY-o.top)*(this.canvas.height/this.dpr/o.height)}};handleMouseLeave=()=>{this.mouse=null};animate(){this.drawParticles(),this.animationId=requestAnimationFrame(this.animate)}setupEventListeners(){this.canvas.addEventListener("mousemove",this.handleMouseMove),this.canvas.addEventListener("mouseleave",this.handleMouseLeave)}destroy(){this.canvas.removeEventListener("mousemove",this.handleMouseMove),this.canvas.removeEventListener("mouseleave",this.handleMouseLeave),this.animationId&&cancelAnimationFrame(this.animationId)}}function x({imageUrl:v,imageElement:e,svgContent:o,particles:a=750,dotSize:t=.9,repulsion:n=80,friction:i=.82,returnSpeed:r=.01,color:s,glow:d=!0,className:g,...c}){const l=y.useRef(null);return y.useEffect(()=>{const m=l.current;if(!m)return;if(e&&(!e.complete||e.naturalWidth===0)){console.warn("MagicLogo: imageElement no está completamente cargado");return}let h;if(v!=null)h={imageUrl:v};else if(e!=null)h={imageElement:e};else if(o!=null)h={svgContent:o};else{console.warn("MagicLogo: falta una fuente de imagen");return}const u={particles:a,dotSize:t,repulsion:n,friction:i,returnSpeed:r,color:s,glow:d,...h},f=new M(m,u);return()=>{f&&f.destroy()}},[v,e,o,a,t,n,i,r,s,d]),L.jsx("canvas",{ref:l,...c,className:E("block mx-auto overflow-visible z-0 w-auto h-auto",g)})}x.__docgenInfo={description:"",methods:[],displayName:"MagicMouseFollower",props:{particles:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"750",computed:!1}},dotSize:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"0.9",computed:!1}},repulsion:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"80",computed:!1}},friction:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"0.82",computed:!1}},returnSpeed:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"0.01",computed:!1}},color:{required:!1,tsType:{name:"string"},description:""},glow:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},className:{required:!1,tsType:{name:"string"},description:""}},composes:["Omit"]};const T={title:"Premium Components/MagicMouseFollower",tags:["autodocs"],parameters:{layout:"centered",docs:{story:{height:"100%",width:"100%"}}},component:x,argTypes:{imageUrl:{type:"string",description:"URL of the image to use as the logo",control:"text",table:{category:"Image URL"}},imageElement:{type:"symbol",description:"React element to use as the logo image",control:"text",table:{category:"Image Element"}},svgContent:{type:"string",description:"Inline SVG content for the logo",control:"text",table:{category:"SVG Content"}},particles:{type:"number",description:"Number of particles in the effect",control:"number",table:{category:"Config"}},dotSize:{type:"number",description:"Size of each particle dot",control:"number",table:{category:"Config"}},repulsion:{type:"number",description:"Repulsion force distance between mouse and particles",control:"number",table:{category:"Config"}},friction:{type:"number",description:"Friction applied to particles movement",control:"number",table:{category:"Config"}},returnSpeed:{type:"number",description:"Speed at which particles return to their original position",control:"number",table:{category:"Config"}},color:{type:"string",description:"Color of the logo in hex format (e.g., #ffffff)",control:"color",table:{category:"Config"}},glow:{type:"boolean",description:"Enable glow effect on the particles",control:"boolean",table:{category:"Effects"}},className:{type:"string",description:"Custom CSS class for additional styling",control:"text",table:{category:"Styling"}}}},p={args:{imageUrl:b,imageElement:void 0,svgContent:void 0,particles:750,dotSize:.9,repulsion:50,friction:.82,returnSpeed:.01,glow:!0}};p.parameters={...p.parameters,docs:{...p.parameters?.docs,source:{originalSource:`{
  args: {
    imageUrl: imgBrandAraldev,
    imageElement: undefined,
    svgContent: undefined,
    particles: 750,
    dotSize: 0.9,
    repulsion: 50,
    friction: 0.82,
    returnSpeed: 0.01,
    glow: true
  }
}`,...p.parameters?.docs?.source}}};const U=["Default"];export{p as Default,U as __namedExportsOrder,T as default};
