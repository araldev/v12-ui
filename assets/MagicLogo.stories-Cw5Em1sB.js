import{j as w}from"./jsx-runtime-BJqp8cEb.js";import{r as b}from"./iframe-BIk3fPms.js";import{c as E}from"./utils-BKj_NWD_.js";class M{canvas;ctx;particles=[];mouse=null;animationId=null;dpr;config;imageElement=null;constructor(e,i){this.canvas=e;const a=e.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("No se pudo obtener el contexto 2D del canvas");this.ctx=a,this.dpr=window.devicePixelRatio||1,this.config=i,this.setupCanvas(),this.initializeEffect()}async initializeEffect(){try{this.config.imageUrl?(console.log("MagicLogo: Cargando imagen desde URL:",this.config.imageUrl),await this.loadImage(this.config.imageUrl)):this.config.svgContent?(console.log("MagicLogo: Cargando SVG como imagen"),await this.loadSVGAsImage(this.config.svgContent)):this.config.imageElement&&(console.log("MagicLogo: Cargando elemento de imagen existente"),await this.loadImageElement(this.config.imageElement)),console.log("MagicLogo: Imagen cargada exitosamente, generando partículas..."),this.generateParticles(),this.setupEventListeners(),this.animate=this.animate.bind(this),this.animate()}catch(e){console.error("MagicLogo: Error al inicializar el efecto:",e)}}async loadImage(e){return await new Promise((i,a)=>{const t=new Image,n=()=>{this.imageElement=t,t.removeEventListener("load",n),t.removeEventListener("error",o),i()},o=r=>{t.removeEventListener("load",n),t.removeEventListener("error",o),a(new Error(`Error al cargar la imagen desde URL: ${e} - ${r.type}`))};t.addEventListener("load",n),t.addEventListener("error",o),t.crossOrigin="anonymous",t.src=e,setTimeout(()=>{t.removeEventListener("load",n),t.removeEventListener("error",o),a(new Error(`Timeout: La imagen desde URL ${e} tardó demasiado en cargar`))},1e4)})}async loadImageElement(e){return await new Promise((i,a)=>{if(e.complete&&e.naturalWidth>0)this.imageElement=e,i();else{const t=()=>{this.imageElement=e,e.removeEventListener("load",t),e.removeEventListener("error",n),i()},n=o=>{e.removeEventListener("load",t),e.removeEventListener("error",n),a(new Error(`Error al cargar la imagen: ${o.type}`))};e.addEventListener("load",t),e.addEventListener("error",n),setTimeout(()=>{e.removeEventListener("load",t),e.removeEventListener("error",n),a(new Error("Timeout: La imagen tardó demasiado en cargar"))},1e4)}})}async loadSVGAsImage(e){return await new Promise((i,a)=>{const t=new Blob([e],{type:"image/svg+xml"}),n=URL.createObjectURL(t),o=new Image,r=()=>{this.imageElement=o,URL.revokeObjectURL(n),o.removeEventListener("load",r),o.removeEventListener("error",s),i()},s=c=>{URL.revokeObjectURL(n),o.removeEventListener("load",r),o.removeEventListener("error",s),a(new Error(`Error al cargar SVG como imagen: ${c.type}`))};o.addEventListener("load",r),o.addEventListener("error",s),o.crossOrigin="anonymous",o.src=n,setTimeout(()=>{URL.revokeObjectURL(n),o.removeEventListener("load",r),o.removeEventListener("error",s),a(new Error("Timeout: El SVG tardó demasiado en cargar"))},1e4)})}setupCanvas(){const e=this.canvas.getBoundingClientRect();this.canvas.width=e.width*this.dpr,this.canvas.height=e.height*this.dpr,this.canvas.style.width=`${e.width}px`,this.canvas.style.height=`${e.height}px`,this.ctx.scale(this.dpr,this.dpr),this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality&&(this.ctx.imageSmoothingQuality="high")}createImageMask(){return this.ctx.clearRect(0,0,this.canvas.width/this.dpr,this.canvas.height/this.dpr),this.imageElement&&this.drawImageToCanvas(this.imageElement),this.ctx.getImageData(0,0,this.canvas.width/this.dpr,this.canvas.height/this.dpr)}drawImageToCanvas(e){const i=this.canvas.width/this.dpr,a=this.canvas.height/this.dpr,n=Math.min(i/e.naturalWidth,a/e.naturalHeight)*.8,o=e.naturalWidth*n,r=e.naturalHeight*n,s=(i-o)/2,c=(a-r)/2;this.ctx.drawImage(e,s,c,o,r)}extractPositions(e){const i=[],{data:a,width:t,height:n}=e,r=Math.max(1,4);let s=0;for(let l=0;l<a.length;l+=4){const[h,f,m,g]=a.slice(l,l+4);g>50&&(h<220||f<220||m<220)&&s++}const c=Math.max(1,Math.floor(Math.sqrt(s/(this.config.particles||6e3)))),d=Math.min(r,c);for(let l=0;l<n;l+=d)for(let h=0;h<t;h+=d){const f=(l*t+h)*4,[m,g,u,y]=a.slice(f,f+4);y>50&&(m<220||g<220||u<220)&&i.push({x:h/this.dpr,y:l/this.dpr,color:`rgb(${m},${g},${u})`})}return i}generateParticles(){if(!this.imageElement){console.warn("No hay imagen cargada para generar partículas");return}const e=this.createImageMask(),i=this.extractPositions(e);if(i.length===0){console.warn("No se encontraron píxeles visibles en la imagen");return}const a=Math.max(this.canvas.width,this.canvas.height)*2;this.particles=i.map(t=>({tx:t.x,ty:t.y,x:t.x+(Math.random()-.5)*a,y:t.y+(Math.random()-.5)*a,vx:0,vy:0,color:t.color,phase:Math.random()*Math.PI*2,age:0,isImmune:Math.random()<.05}))}updateParticle(e){const i=e.tx-e.x,a=e.ty-e.y;if(this.mouse&&this.config.attractMode){const o=this.mouse.x-e.x,r=this.mouse.y-e.y,s=Math.hypot(o,r);if(s<this.config.repulsion&&s>0){const d=10*Math.max(0,1-s/this.config.repulsion);e.vx+=o/s*d,e.vy+=r/s*d}}else if(this.mouse&&!this.config.attractMode){const o=this.mouse.x-e.x,r=this.mouse.y-e.y,s=Math.hypot(o,r);if(s<this.config.repulsion&&s>0){let c;this.config.trace?e.isImmune?c=(this.config.repulsion-s)/this.config.repulsion*.1:c=Math.max(0,1-s/this.config.repulsion):c=Math.max(0,1-s/this.config.repulsion);const d=20*c;e.vx-=o/s*d,e.vy-=r/s*d}}const t=.04,n=.73;e.vx+=i*t,e.vy+=a*t,e.vx*=n,e.vy*=n,e.x+=e.vx,e.y+=e.vy}drawParticles(){const e=this.canvas.width/this.dpr,i=this.canvas.height/this.dpr;this.ctx.clearRect(0,0,e,i);for(const a of this.particles){this.updateParticle(a),a.age+=1;const t=(Math.sin(a.phase+a.age*.15)+1)/2;this.ctx.fillStyle=this.config.color||a.color||"#fff",this.config.glow&&(this.ctx.globalAlpha=t),this.ctx.beginPath(),this.ctx.arc(a.x,a.y,this.config.dotSize,0,Math.PI*2),this.ctx.fill()}this.ctx.globalAlpha=1}handleMouseMove=e=>{const i=this.canvas.getBoundingClientRect();this.mouse={x:(e.clientX-i.left)*(this.canvas.width/this.dpr/i.width),y:(e.clientY-i.top)*(this.canvas.height/this.dpr/i.height)}};handleMouseLeave=()=>{this.mouse=null};animate(){this.drawParticles(),this.animationId=requestAnimationFrame(this.animate)}setupEventListeners(){this.canvas.addEventListener("mousemove",this.handleMouseMove),this.canvas.addEventListener("mouseleave",this.handleMouseLeave)}destroy(){this.canvas.removeEventListener("mousemove",this.handleMouseMove),this.canvas.removeEventListener("mouseleave",this.handleMouseLeave),this.animationId&&cancelAnimationFrame(this.animationId)}}function L({imageUrl:p,imageElement:e,svgContent:i,particles:a=750,dotSize:t=.9,repulsion:n=80,friction:o=.82,returnSpeed:r=.01,color:s,glow:c=!0,trace:d=!0,attractMode:l=!1,className:h,...f}){const m=b.useRef(null);return b.useEffect(()=>{const g=m.current;if(!g)return;if(e&&(!e.complete||e.naturalWidth===0)){console.warn("MagicLogo: imageElement no está completamente cargado");return}let u;if(p!=null)u={imageUrl:p};else if(e!=null)u={imageElement:e};else if(i!=null)u={svgContent:i};else{console.warn("MagicLogo: falta una fuente de imagen");return}const y={particles:a,dotSize:t,repulsion:n,friction:o,returnSpeed:r,color:s,glow:c,trace:d,attractMode:l,...u},x=new M(g,y);return()=>{x&&x.destroy()}},[p,e,i,a,t,n,o,r,s,c,d,l]),w.jsx("canvas",{ref:m,...f,className:E("block mx-auto overflow-visible z-0 w-auto h-auto",h)})}L.__docgenInfo={description:"",methods:[],displayName:"MagicLogo",props:{particles:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"750",computed:!1}},dotSize:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"0.9",computed:!1}},repulsion:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"80",computed:!1}},friction:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"0.82",computed:!1}},returnSpeed:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"0.01",computed:!1}},color:{required:!1,tsType:{name:"string"},description:""},glow:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},trace:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},attractMode:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},className:{required:!1,tsType:{name:"string"},description:""}},composes:["Omit"]};const R={title:"Premium Components/MagicLogo",tags:["autodocs"],parameters:{layout:"centered",docs:{story:{height:"100%",width:"100%"}}},component:L,argTypes:{imageUrl:{type:"string",description:"URL of the image to use as the logo",control:"text",table:{category:"Image URL"}},imageElement:{type:"symbol",description:"React element to use as the logo image",control:"text",table:{category:"Image Element"}},svgContent:{type:"string",description:"Inline SVG content for the logo",control:"text",table:{category:"SVG Content"}},particles:{type:"number",description:"Number of particles in the effect",control:"number",table:{category:"Config"}},dotSize:{type:"number",description:"Size of each particle dot",control:"number",table:{category:"Config"}},repulsion:{type:"number",description:"Repulsion force distance between mouse and particles",control:"number",table:{category:"Config"}},friction:{type:"number",description:"Friction applied to particles movement",control:"number",table:{category:"Config"}},returnSpeed:{type:"number",description:"Speed at which particles return to their original position",control:"number",table:{category:"Config"}},color:{type:"string",description:"Color of the logo in hex format (e.g., #ffffff)",control:"color",table:{category:"Config"}},glow:{type:"boolean",description:"Enable glow effect on the logo",control:"boolean",table:{category:"Effects"}},trace:{type:"boolean",description:"Enable tracing effect on the particles",control:"boolean",table:{category:"Effects"}},attractMode:{type:"boolean",description:"Enable attract mode for particles",control:"boolean",table:{category:"Effects"}},className:{type:"string",description:"Custom CSS class for additional styling",control:"text",table:{category:"Styling"}}}},v={args:{imageUrl:"/src/assets/brand-araldev-miniatura.webp",imageElement:void 0,svgContent:void 0,particles:750,dotSize:.9,repulsion:50,friction:.82,returnSpeed:.01,glow:!0,trace:!0,attractMode:!1}};v.parameters={...v.parameters,docs:{...v.parameters?.docs,source:{originalSource:`{
  args: {
    imageUrl: '/src/assets/brand-araldev-miniatura.webp',
    imageElement: undefined,
    svgContent: undefined,
    particles: 750,
    dotSize: 0.9,
    repulsion: 50,
    friction: 0.82,
    returnSpeed: 0.01,
    glow: true,
    trace: true,
    attractMode: false
  }
}`,...v.parameters?.docs?.source}}};const P=["Default"];export{v as Default,P as __namedExportsOrder,R as default};
